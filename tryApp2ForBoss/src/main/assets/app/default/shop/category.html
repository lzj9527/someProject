<!doctype html>
<html>

<head>
    <title>分类</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <!-- bootstrap start -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/bootstrap-theme.min.css">

    <script src="../static/js/config.js"></script>
    <script src="../static/js/jquery-3.0.0.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../static/js/androidJSInterface.js"></script>
    <script src="../static/js/touch.js"></script>
    <script src="../static/js/swiper.min.js"></script>
    <!-- bootstrap end -->

    <link rel="stylesheet" href="../static/css/swiper.min.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-box.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-base.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-color.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-control.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-icon.css">
    <link rel="stylesheet" type="text/css" href="../static/css/ui-my.css">

    <script src="../static/js/dataVerify.js"></script>
    <script src="../static/js/function.js"></script>

    <style>
        .discountShow{
            display: block;
            opacity: 1;
        }
        .discountHide{
            position: relative;
            z-index: -1 !important;
            filter:alpha(opacity=0);  /*支持 IE 浏览器*/
            -moz-opacity:0; /*支持 FireFox 浏览器*/
            opacity: 0;
            transition: all 0.5s;
        }
    </style>
</head>

<body class="um-vp" ontouchstart>
    <div id="page_1" class="up ub" tabindex="0">
        <div class="ub ub-fh">
            <div id="content" class="ub ub-f1  ub-ver" style="position: relative;">
                <!-- 搜索框 -->
                <div class="ub bc-bg-d3">
                    <div class="ub-f1  ub-pc ub-ac uinn bc-text-a11" style="width:4.2em;margin:0;">
                        <select name="selSearchCategory" id="selSearchCategory" class="form-control tx-c" style="width:100%; padding:0; margin:0;">
                            <option value="证书" class="tx-c">证书</option>
                            <option value="款号" class="tx-c">款号</option>
                        </select>
                    </div>

                    <div class="ub ub-f3 ub-ac uinnx bc-bg-d3 ub-f6 ">
                        <input type="text" class="form-control  ub  uinn keywords bc-border-d3 ub-img5 size12" style="background-position:center right; background-size:2em;border:none;"
                            placeholder="全部GIA证书都可查询" />
                        <a class="glyphicon glyphicon-remove btn form-control-feedback  bc-text-c1 btnclear hide  " style="pointer-events: auto; line-height: 40px;"></a>
                        <input type="hidden" name="searchtype" value="c" id="searchtype">
                    </div>

                    <div class=" ub ub-f1   bc-text-c5 ub-pc ub-ac  btsearch size14 uc-a3" style="margin:0.2em  0em  0.2em 0em; padding:0.1em 0.2em">搜 索</div>
                </div>


                <!--<div>
                    <div class="ub ub-f4">
                        <div class="ub ub-f1 ub-pc ub-ac active uinn  activee  bc-border-a2 " id="kuanhao">款号</div>
                        <div class="ub ub-f1 ub-pc ub-ac uinn bc-text-a11" id="zhbook">证书</div>
                    </div>
                </div>
                <div class="ub ">
                    <div class="ub ub-f1 uinnx bc-bg-d3">
                        <div class="ub ub-ac ub-f1 ">
                            <input type="text" class="form-control  ub  uinn keywords bc-border-d3 ub-img5 size12" style="background-position:center right; background-size:2em;border:none;"
                                placeholder="请输入产品关键字进行搜索" />
                            <a class="glyphicon glyphicon-remove btn form-control-feedback  bc-text-c1 btnclear hide  " style="pointer-events: auto; line-height: 28px;"></a>
                            <input type="hidden" name="searchtype" value="p" id="searchtype">
                        </div>
                        <div class=" ub   bc-text-c5 ub-pc ub-ac  btsearch size14 uc-a3" style="margin:0.2em  0em  0.2em 0.5em; padding:0.2em 1em">搜 索</div>
                    </div>
                </div>-->

                <!-- banner -->
                <div class="swiper-container" style="background: #000;">
                    <div class="swiper-wrapper" id="banner">
                        <!-- <div class="swiper-slide">
                            <img src="../static/images/categorytitle.png" style="display:inline-block;width:100%;">
                        </div>
                        <div class="swiper-slide">
                            <img src="../static/images/categoryt02.jpg" style="display:inline-block;width:100%;">
                        </div>
                        <div class="swiper-slide">
                            <img src="../static/images/categoryt03.jpg" style="display:inline-block;width:100%;">
                        </div> -->
                    </div>
                    <div class="swiper-pagination"></div>
                </div>

                <!--<div>
                    <img src="../static/images/categorytitle.png" style="display:inline-block;width:100%;">
                </div>-->

                <!-- nav -->
                <!--<div class="ub" style="padding:0.3em 0.2em;margin:0.5em;">-->
                    <!--<div class="ub ub-f4">-->
                        <!--<div class="ub ub-f1 ub-pc ub-ac active uinn bc-text-a2 ubb bc-border-a2">首页</div>-->
                        <!--<div class="ub ub-f1 ub-pc ub-ac uinn uinn uinn allproduct  bc-text-c2">全部商品</div>-->
                        <!--<div class="ub ub-f1 ub-pc ub-ac uinn uinn btngoodsprice  bc-text-c2">报价表</div>-->
                        <!--&lt;!&ndash;<div class="ub ub-f1 ub-pc ub-ac uinn uinn hotgoodslist  bc-text-c2">促销商品</div>&ndash;&gt;-->
                        <!--<div class="ub ub-f1 ub-pc ub-ac uinn uinn aboutUs  bc-text-c2">关于我们</div>-->
                    <!--</div>-->
                <!--</div>-->
                <div class="ub">
                    <div class="ub  ub-f4 ub-ver umar-t" id="categorylist"> <!-- 商品列表 -->

                    </div>
                </div>

                <div style="width:100%; height:2.4em;"></div>
                
            </div>
        </div>
    </div>
</body>
<script>
    $(function () {
        var key = getKey();

        var PSEARCH = 'p'; // 款号搜索
        var CSEARCH = 'c'; // 证书搜索

        // $.ajax({
        //     url: '',
        //     type: 'get',
        //     dataType: 'jsonp',
        //     success: function(data){
        //         console.log(data);

        //     },
        //     error: function(){
        //         //showToast("error!");
        //     }
        // });

        /*
         *  首页内容
         */
        function show_category(data) {
            var i = 0,
                maxLength = data.datas.list[0].child.length,
                strHtml = '<div class="ub" >';
            // console.log(data.datas.list[0].child[i]);

//            // 特价裸钻
//            strHtml += '<div class="ub ub-f1 ub-ac ub-pc ">                            ' +
//                '<div class="ubi ub-img " style="width:100%;padding-bottom:100%;height:0px; background-image:url(../static/images/categoryt_list01.jpg)"   id="disCountCate_8" ></div> ' +
//                '</div>';

            // 裸钻
            strHtml += '<div class="ub ub-f1 ub-ac ub-pc ">                            ' +
                '<div class="ubi ub-img " style="width:100%;padding-bottom:100%;height:0px; background-image:url(../static/images/categoryt_list01.jpg)"   id="cate_8" ></div> ' +
                '</div>';
            // 热销产品
            strHtml += '<div class="ub ub-f1 ub-ac ub-pc ">                            ' +
                '<div class="ubi ub-img " style="width:100%;padding-bottom:100%;height:0px; background-image:url(../static/images/categoryt_list02.jpg)"   id="giagoods" ></div> ' +
                '</div>';
            strHtml += '<div class="ub ub-f1 ub-ac ub-pc ">                            ' +
                '<div class="ubi ub-img " style="width:100%;padding-bottom:100%;height:0px; background-image:url(../static/images/categoryt_list03.jpg)"   id="hotgoodslist" ></div> ' +
                '</div>';


            //console.log(data);
            for (; i < maxLength; i++) {

                if (i % 3 == 0 && i < maxLength) {
                    strHtml += '</div><div class="ub ">';
                }

                // 其他的商品
//                console.log(data.datas.list[i]);
                strHtml += '<div class="ub ub-f1 ub-ac ub-pc ">                            ' +
                    '<div class="ubi ub-img btcate" style="width:100%;padding-bottom:100%;height:0px; background-image:url(' +
                    data.datas.list[0].child[i].thumb + ')"  data-names="' + data.datas.list[0].child[i].name +
                    '"   data-values="' + data.datas.list[0].child[i].id + '" ></div> ' +
                    '</div>';

                if (i % 3 == 0 && i == maxLength - 1) {
                    strHtml += '<div class="ub ub-f1 ub-ac ub-pc" ></div>';
                    strHtml += '<div class="ub ub-f1 ub-ac ub-pc" ></div>';
                }
                if (i % 3 == 1 && i == maxLength - 1) {
                    strHtml += '<div class="ub ub-f1 ub-ac ub-pc" ></div>';
                }
            }

            strHtml += '</div>';

            $('#categorylist').html(strHtml);

            var isEmployeeUpload;
            // 商品列表
            touch.on('.btcate', 'tap', function (ev) { // 监听各种商品的点击
                var ccate = $(this).data("values");
                var catename = $(this).data("names"); // 标题
                isEmployeeUpload = $(this).data("isEmployeeUpload"); // 有数据之后就打开 isEmployeeUpload 0:不是内部上传图片列表 1:是内部上传图片列表
                if(!isDefine(isEmployeeUpload)){
                    isEmployeeUpload = 0
                }else{
                    isEmployeeUpload = 1
                }
//                var isEmployeeUpload = 1;
                console.log(isEmployeeUpload);
//                console.log(data);
//                console.log(ccate);
//                console.log(catename);
                openWindow(6, catename,
                    appUrl + '/addons/ewei_shop/template/app/default/shop/list.html?ccate=' +
                    ccate + '&catename=' + catename + '&isEmployeeUpload=' + isEmployeeUpload,
                    'shop,list.html?ccate=' + ccate + '&catename=' + catename + '&isEmployeeUpload=' + isEmployeeUpload);
                return isEmployeeUpload;
            });

//            // 打开 特价裸钻
//            touch.on('#disCountCate_8', 'tap', function (ev) {
//                    openDetailWindowInDiamond(id,''); // 预留做特价裸钻 id 写死
//
//            });

            // 打开 订货裸钻
            touch.on('#cate_8', 'tap', function (ev) {
                openWindow(10, '订货裸钻',
                    appUrl + '/addons/ewei_shop/template/app/default/api/select.html',
                    'api,select.html');
            });

            //打开 热销产品
            touch.on('#hotgoodslist', 'tap', function (ev) {
                var catename = '热销产品';
//                catename = escape(catename).replace(/%/g,"\"); // 页面的标题
//                catename;
                if(!isDefine(isEmployeeUpload)){
                    isEmployeeUpload = 0
                }else{
                    isEmployeeUpload = 1
                }
                console.log(catename);
                console.log(isEmployeeUpload);
                openWindow(6, catename,
                    appUrl +
                    '/addons/ewei_shop/template/app/default/shop/list.html?ccate=isdiscount&isEmployeeUpload='+isEmployeeUpload,
                    'shop,list.html?ccate=isdiscount&isEmployeeUpload='+isEmployeeUpload);
            });

            //打开现货裸钻
            touch.on('#giagoods', 'tap', function (ev) {
                //storage["catename"] ='促销商品';
                var catename = '现货裸钻';
                catename = escape(catename);
                openWindow(6, '现货裸钻',
                    appUrl + '/addons/ewei_shop/template/app/default/api/giaSpotGoods.html',
                    'api,giaSpotGoods.html');
            });
        }

        // 可选的
        $.ajax({
            url: appUrl + '/app/index.php?i=2&c=entry&m=ewei_shop&v=pad&do=goods&p=goods_cate',
            type: "get",
            dataType: 'jsonp',
            success: function (data) {
                console.log(data);
                if (data.resultCode == "0") {
                    show_category(data); // 遍历生成商品
                } else {
                    showToast(data.error);
                }
            },
            error: function () {
                //showToast("error!");
            }
        });

        /*
         *  轮播图
         */
        // banner图片的加载

        var ERROR = -1;
        var SUCCESS = 0;
        // banner 占位图
        var bannerPlaceholder = [{
            advname: "首页",
            thumb: {
                url: "../static/images/categorytitle.png"
            }
        }];

        function BannerImage(data) {
//            console.log(data);
            if (!data || !data.thumb) {
                return false;
            }
            this.imgUrl = data.thumb.url;
            this.name = data.advname;
            this.goodsid = data.goodsid;
            this.tag = data.tag;
        }

        // 点击banner
        function addEvent() {
            $('.banneritem').click(function (ev) {
//                console.log(this);
                var $img = $(this).children('.bannerimg');
                var id = $img.data('goodsid');
                console.log(id);
                var disCountGia = $img.data('advname').toString();
                console.log(disCountGia);
                console.log(this);
                var tag = $img.data('tag');
                if(id === "undefined" && disCountGia === "特价钻"){
                    openDetailWindowInDiamond('','');
                }else if (id !== 'undefined') {
                    if (tag === 'two') {
                        openDetailWindowInCoupleRing(id, '');
                    }else{
                        openDetailWindow(id, '');
                    }
                }

            });
        }

        $.ajax({
            url: appUrl + '/app/index.php?i=2&c=entry&m=ewei_shop&v=pad&do=goods&p=goods_ad',
            type: 'get',
            dataType: 'jsonp',
            timeout: 5000,
            success: function (res) {
                console.log(res);
//                console.log(res.datas);
//                console.log(res.datas.list);
//                console.log(res.datas.list[0]);
                var bannerList = [];
                if (res.resultCode == ERROR) {
                    bannerList = bannerPlaceholder;
                } else {
                    bannerList = res.datas.list;
                    console.log(bannerList)
                }
                renderBanner(bannerList);
                addEvent();
            },
            error: function (error) {
                renderBanner(bannerPlaceholder);
                showToast(error);
            }
        });

        // 轮播生成
        function renderBanner(data) {
            if (!data) {
                return;
            }
            var html = '';
//            console.log(data[0]);
            for (var i = 0, l = data.length; i < l; i++) {
                var img = new BannerImage(data[i]);

                html += '<div class="swiper-slide banneritem">' +
                    '<img class="bannerimg" src="' + data[i].thumb.url +
                    '" style="display:inline-block;width:100%;" data-goodsid="' + data[i].goodsid +
                    '" data-tag="' + data[i].tag +
                    '" data-advname="' + data[i].advname + '">'+
                    '</div>';
            }

            $('#banner').html(html);
            var mySwiper = new Swiper('.swiper-container', {
                autoplay: 2000, //可选选项，自动滑动
                speed: 900,
                loop: true,
                pagination: '.swiper-pagination',
                autoplayDisableOnInteraction: false,
                paginationHide: false // 按钮的显示隐藏
            })
        }

        /*
         *  导航栏点击代码
         */
        touch.on('.allproduct', 'tap', function (ev) {
            //storage["catename"] ='全部商品';
            var catename = '全部商品';
            catename = escape(catename);
            openWindow(6, '产品列表',
                appUrl + '/addons/ewei_shop/template/app/default/shop/list.html?catename=' +
                catename,
                'shop,list.html?catename=' +
                catename);
        });

        // 关于我们
        touch.on('.aboutUs', 'tap', function (ev) {
            //storage["aboutUs"] ='促销商品';
            var catename = '关于我们';
            catename = escape(catename);
            openWindow(6, '关于我们', appUrl + '/addons/ewei_shop/template/app/default/shop/aboutus.html',
                'shop,aboutus.html');
        });

        touch.on('.btngoodsprice', 'tap', function (ev) {  // 报价表
            var catename = '报价表';
            catename = escape(catename); // escape 对字符串进行解码
            openWindow(19, '报价表',  // openWindow的参数 index, title, url, pathUrl
                appUrl + '/addons/ewei_shop/template/app/default/shop/about_price.html','shop,about_price.html');

        });
        /*
         *  搜索栏
         */
        $('#selSearchCategory').change(function () {
            if ($('#selSearchCategory').val() === '证书') {
                $('.keywords').attr("placeholder", "全部GIA证书都可查询");
                $('#searchtype').val(CSEARCH);
            } else if ($('#selSearchCategory').val() === '款号') {
                $('.keywords').attr("placeholder", "请输入产品关键字进行搜索");
                $('#searchtype').val(PSEARCH);
            }
        });

        touch.on('.btsearch', 'touchstart', function (ev) {
            $(".btsearch").removeClass("bc-text-c5");
        });

        touch.on('.btsearch', 'touchend', function (ev) {
            $(".btsearch").addClass("bc-text-c5");
        });

        touch.on('.btsearch', 'tap', function (ev) {

            var searchtype = $('#searchtype').val();
            var keywords = encodeURI(encodeURI($('.keywords').val()));
            var catename = '搜索';
            catename = escape(catename);
            if (searchtype == 'p') {
                //console.log('搜索款号');
                openWindow(6, '产品列表',
                    appUrl + '/addons/ewei_shop/template/app/default/shop/list.html?keywords=' +
                    keywords + '&catename=' + catename,
                    'shop,list.html?keywords=' +
                    keywords + '&catename=' + catename);
            } else {
                if (searchtype == 'c') {
                    // console.log('搜索证书');
                    dataVerify({
                        str: keywords,
                        rules: ['isGIANumber'],
                        success: function () {
                            downloadGIACer(keywords, appUrl +
                                '/addons/ewei_shop/api/pdf.php?gia=' +
                                keywords + '&key=' + key);
                        },
                        error: function (errorMsg) {
                            showToast(errorMsg);
                        }
                    });
                }
            }
        });
        $('.keywords').change(function (ev) {

            if ($(this).val()) {
                //console.log('r');
                $('.btnclear').removeClass('hide');
            } else {
                //console.log('a');
                $('.btnclear').addClass('hide');
            }
        });
        touch.on('.btnclear','tap', function (ev) {
            $('.keywords').val('');
            $('.btnclear').addClass('hide');
        });

    });

// 特价裸钻,每天凸显一次
if(window.localStorage.length === 0){
    console.log("无 cookie 啊仔,所以做野啦");
    disCountAd();
    var nowTime = new Date(),
        nowYear = nowTime.getFullYear(),
        nowMounth = nowTime.getMonth() + 1,
        nowDay =  nowTime.getDate();
    var myTime = nowYear + "." + nowMounth + "." +  nowDay;
    myTime = myTime.toString();
    console.log(myTime);
    window.localStorage["getTime"] = myTime;
    nowTime,nowYear,nowMounth,nowDay = null;
}

if(window.localStorage.length > 0){
    console.log("有 cookie 啦仔");
    var newTime = new Date(),
        newYear = newTime.getFullYear(),
        newMounth = newTime.getMonth() + 1,
        newDay =  newTime.getDate();
    var myNewTime = newYear + "." + newMounth + "." +  newDay;
    myNewTime = myNewTime.toString();
    if(myNewTime !== localStorage["getTime"]){
        console.log("时间有变，兄弟做野");
        disCountAd();
        window.localStorage["getTime"] = myNewTime; // 换成新的
    }else{
        console.log("滴野一样葛,坐定定系度,乜都唔洗做");
    }
    newTime,newYear,newMounth,newDay = null;
}

// 特价裸钻的蒙版
function disCountAd() {
    var strHtml = '';
    strHtml +=
        '<div id="discountGia" style="width: 100%;height: 122%; background: rgba(0,0,0,0.5);position: absolute;left:0;top:0;z-index:2">'+
        '<img src="../static/images/disCountGia_jiantou.png" style="width: 76%;position: absolute;left:6%; top:14%;" alt="特价箭头">'+
        '<img id="discountGiaImg" src="http://www.zsmtvip.com/attachment/images/2/2017/12/s2ZmeGrG652JuQs9sOp5mOR6P6Ds66.jpg" alt="特价裸钻" width="100%;" style="position: absolute;left:0; top:36%;z-index:2;">'+
        '<div style="text-align: center;position: absolute;top:66%;">'+
        '<img src="../static/images/closeIcon.png" alt="关闭的按钮" style="width: 38%;">'+
        '</div>'+
        '</div>';
    $('#page_1').append(strHtml);
    // $('#page_1').append(typeof obj)
    var discountGia = document.getElementById("discountGia");
    var discountGiaImg = document.getElementById("discountGiaImg");
    clickEvent(discountGia,discountGia,"discountHide");
    discountGiaImg.onclick = function () {
        openDetailWindowInDiamond("","")
    };
    discountGia = null;
    discountGiaImg = null;
}

function clickEvent(obj,obj1,className) {
    obj.onclick = function () {
        obj1.className = className;
    };
}

</script>

</html>

































