<!DOCTYPE html>
<html>
<title>裸钻</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
<meta name="format-detection" content="telephone=no" />
<!-- bootstrap start -->

<script src="GIA_files/jquery-1.js"></script>
<script src="../static/js/bootstrap.min.js"></script>

<!-- bootstrap end -->
<script src="../static/js/config.js"></script>

<script src="../static/js/touch.js"></script>
<script src="../static/js/config.js"></script>
<script src="../static/js/function.js"></script>
<script src="../static/js/jquery.range.js"></script>
<script src="../static/js/androidJSInterface.js"></script>
<link rel="stylesheet" type="text/css" href="../static/css/ui-box.css">
<link rel="stylesheet" type="text/css" href="../static/css/ui-base.css">
<link rel="stylesheet" type="text/css" href="../static/css/ui-color.css">
<link rel="stylesheet" type="text/css" href="../static/css/ui-control.css">
<link rel="stylesheet" type="text/css" href="../static/css/ui-icon.css">
<link rel="stylesheet" type="text/css" href="../static/css/ui-my.css">
<link rel="stylesheet" type="text/css" href="../static/css/jquery.range.css">
<link href="GIA_files/main_app.css" type="text/css" rel="stylesheet">
<!--[if lt IE 9]>
      <script src="../static/js/html5shiv.min.js"></script>
      <script src="../static/js/respond.min.js"></script>
    <![endif]-->
</head>

<body class="um-vp" ontouchstart style="background-color:#fff; overflow-x: hidden;">

    <div class="page-box page-of-diamonds" style=" padding:0px; margin:0px;">
        <div class="diamond-search-form container" id="diamond-search-form" style="padding:0px;">
            <form>
                <div class="basic" style="float:none">
                    <div id="page_1" class="ub" tabindex="0">
                        <div class="ub  ub-f1 ub-ver">
                            <div class=" ub item shape  " style="border:0px; text-align:center; overflow:auto; padding:0.2em 0.2em 0">
                                <div class="ub">
                                    <span>形状: &nbsp;默认圆形、标准圆钻</span>
                                </div>
                            </div>

                            <div class="ub umh3 bc-bg-c4 ubt bc-border-b1">
                                <div class="ub uinn3 ub-f1">
                                    <div class="ub umar-l">颜色</div>
                                    <!-- <div data-toggle="tooltip" data-placement="bottom" title="" class="ub umh1 umw1 ub-img umar-l bc-bg-c4 " style="background-image:url(../static/images/question_s.png)"></div> -->
                                </div>
                            </div>
                            <div class="ub uinn3 item color">
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em" data-value=">D">D</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="E">E</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="F">F</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="G">G</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="H">H</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="I">I</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="J">J</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="K">K</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="L">L</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="M">M</div>
                            </div>
                            <div class="ub umh3 bc-bg-c4 ubt bc-border-b1">
                                <div class="ub uinn3 ub-f1">
                                    <div class="ub umar-l">净度</div>
                                    <!-- <div data-toggle="tooltip" data-placement="bottom" title="" class="ub umh1 umw1 ub-img umar-l bc-bg-c4 " style="background-image:url(../static/images/question_s.png)"></div> -->
                                </div>
                            </div>
                            <div class="ub uinn3 item clarity">
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em" data-value="FL/IF">FL/IF</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VVS1">VVS1</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VVS2">VVS2</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VS1">VS1</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VS2">VS2</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="SI1">SI1</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="SI2">SI2</div>
                                <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="I1">I1</div>
                            </div>

                            <div class="ub umh3 ">
                                <div class="ub uinn3">
                                    <div class="ub uinn3 umar-l">切工</div>
                                    <!-- <div data-toggle="tooltip" data-placement="bottom" title="" class="ub umh1 umw1 ub-img umar-l bc-bg-c4 " style="background-image:url(../static/images/question_s.png)"></div> -->
                                </div>

                                <div class="ub uinn3  item cut ex3 ub-f1">
                                    <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;" data-value="EX">EX完美</div>
                                    <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VG">VG很好</div>
                                    <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="GD">GD好</div>
                                </div>
                            </div>

                            <div class="ub  extradiv ub-ver  " style="">

                                <div class="ub umh3 ">
                                    <div class="ub uinn3">
                                        <div class="ub uinn3 umar-l">荧光</div>
                                        <!-- <div data-toggle="tooltip" data-placement="bottom" title="" class="ub umh1 umw1 ub-img umar-l bc-bg-c4 " style="background-image:url(../static/images/question_s.png)"></div> -->
                                    </div>

                                    <div class="ub uinn3  item fluorescence ex3 ub-f1">
                                        <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;" data-value="N">N无</div>
                                        <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="VSL/F">VSL/F轻</div>
                                        <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="M">M中</div>
                                        <div class="ub ub-f1 uba  uinn3 ub-pc bc-text-b1 option" style="margin:0 auto; padding:0.5em 0em;border-left:0px;" data-value="S">S强</div>
                                        <!-- <div class="ub ub-f1 uba  uinn ub-pc bc-text-b1 option special" style="margin:0 auto; padding:0.5em 0em;border-left:0px;">3EX无荧光</div> -->
                                    </div>
                                </div>

                                <div class="ub umh3" style="margin:0.1em 0 0.2em 0;">
                                    <div class="ub uinn3">
                                        <div class="ub uinn3 umar-l">证书</div>
                                    </div>
                                    <div class="ub uinn3">
                                        <div class="ub uinn3 umar-l">
                                            <input type="radio" name="certificate" checked style="position:relative; top: 1px;" id="GIA_search" value="GIA">
                                            <label for="GIA_search">GIA</label>
                                            <input type="radio" name="certificate" style="position:relative; top: 1px;" id="SJ_search" value="SJ">
                                            <label for="SJ_search">省检</label>
                                        </div>

                                    </div>
                                    <div class="ub uba ub-f1 " style="margin:0.2em; padding:0.02rem 0em;overflow:hidden">
                                        <input type="text" size="3" id="q_id1" name="agename" class=" " value="" style="vertical-align:middle;height:2.3em;z-index:1;margin-left:0.5em;margin-top:-0.4em;margin-right:0.5em;position:absolute;width:100%;display:block;overflow:hidden;"
                                            id="num" placeholder="输入GIA证书号码快速查询" />
                                    </div>
                                </div>
                            </div>

                            <div class="row" style="margin: 0 0.5em 0.5em;">
                                <div class="ub uinn bc-bg-a1 bc-text-head ub-pc ub-ac " id="btn_search" style="border-radius: 5px;float:right;width:44%;">搜 索
                                    <a href=""></div>
                                <div class="ub uinn bc-bg-a1 bc-text-head ub-pc ub-ac" id="btn_reset" style="border-radius: 5px;float:left;width:44%;">重 置</div>
                            </div>

                        </div>
                    </div>
                    <script>
                        $(document).ready(function () {
                            $('[data-toggle="tooltip"]').tooltip()
                        })
                    </script>
                    <!-- 滑块 -->
                    <SCRIPT type="text/javascript">
                        $(document).ready(function () {

                            $('.range-slider').jRange({
                                from: 1000,
                                to: 500000,
                                step: 5000,
                                //scale: [1000, 50000, 100000,250000, 500000],
                                format: '%s',
                                width: $(document).width() - 40,
                                showLabels: false,
                                isRange: false,
                                obj: 'price'
                            });

                            $('.range-slider2').jRange({
                                from: 0.3,
                                to: 1.5,
                                step: 0.05,
                                //scale: [1000, 50000, 100000,250000, 500000],
                                format: '%s',
                                width: $(document).width() - 40,
                                showLabels: false,
                                isRange: false,
                                obj: 'weight'
                            });
                        });
                    </SCRIPT>
                </div>
            </form>
        </div>
        <div class="data-box container" style=" padding:0px; margin:0px;" id="data-box-22">
            <div class="pagination" id="pagination-top" style="display:none;padding:0px; margin:0px; height:0px; overflow:hidden">
                <div class="data-total" style="display:none">当前裸钻数量：<span id="total_diamonds">0</span>颗 / 显示<span id="total">0</span>颗</div>
                <div class="pager" style="clear:both; display:none">
                    <a class="prev page-button"></a>
                    <span class="paging">0 / 0</span>
                    <a class="next page-button"></a>
                    <input class="ipt-jump" type="text">
                    <a class="btn-jump page-button">跳转</a>
                </div>
            </div>
            <table class="table zebra" id="diamond-data-table" cellpadding="0" cellspacing="0" width="100%" style="margin-top:0px;">
                <thead>
                    <tr>
                        <!-- <th style="font-size:10px;">货号</th> -->
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;display:none;">形状</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;"><a href="javascript:" class="sortable" id="order-by-carat-link">重量</a></th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">颜色</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">净度</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">切工</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">抛光</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">对称</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; text-align:center;font-size:12px;">荧光</th>
                        <!--保留-->
                        <th style="padding:0.8em 0; width: 82px; text-align:center;font-size:12px;" colspan="2">直径</th>
                        <th></th>
                        <th style="display:none">咖色</th>
                        <th style="display:none">奶色</th>
                        <th style="display:none">证书</th>
                        <!--保留-->
                        <th style="display:none">证书号</th>
                        <!--保留-->
                        <th style="display:none">图片</th>
                        <th style="display:none">视频</th>
                        <!-- 如果是万宝二级的零售模式下的会员,则不展示国际美金-->
                        <!--<th>国际美金</th>-->
                        <th style="display:none"><a href="javascript:;" class="sortable" id="order-by-discount-link">折扣</a></th>
                        <th style="padding:0.8em 0; text-align:center;font-size:10px;display:none;"><a href="javascript:" class="sortable asc" id="order-by-price-link">RMB/粒</a></th>
                        <th style="display:none">原折扣</th>
                        <th style="padding:0.8em 0; min-width: 40px; text-align:center;font-size:10px;display:none;"> 选 择 </th>
                    </tr>
                </thead>
                <!-- 数据列表-->
                <tbody id="diamond-list">
                </tbody>
            </table>
        </div>
        <div style="border-top:1px #eee solid;padding-top:0.5em;padding:0px;margin:0px;"></div>
        <div class="pagination" id="pagination-bottom" style="margin-bottom:2em;font-size:12px; padding:12px 0px;margin: 0px; background-color:#fff;">
            <div class="pager" style=" text-align:center;font-size:12px; padding:0px;margin: 0px; ">
                <a class="prev page-button" style="font-size:12px;"></a>
                <span class="paging" style="font-size:12px;">0 / 0</span>
                <a class="next page-button" style="font-size:12px;"></a>
                <input class="ipt-jump" type="text" style="font-size:12px;">
                <a class="btn-jump page-button" style="font-size:12px;">跳转</a>
            </div>
        </div>
    </div>
    <!-- 添加购物车成功弹窗 -->
    <div id="success-masking" style="display:none;">
        <div class="masking-content">
            <div class="masking-title">
                <img src="./images/icons/boss_add_shopping_success.png" alt="">
                <span>成功加入购物车</span>
            </div>
            <div class="masking-bottom">
                <div id="masking-opencart" style="background:#ce1d36;">查看购物车</div>
                <div id="masking-control" style="margin-left:10%;background:#dfcab2">继续逛逛</div>
            </div>
        </div>
    </div>
    <!--不咖不奶弹窗-->
    <!-- <div class="milkwindow" style="display:none;width:360%;position:absolute;left:-130%;top:80%;background:#fff;z-index:999;box-shadow:0 0 5px #888888;"></div> -->
    <!-- 弹窗蒙版 -->
    <div id="window-top" style="display:none;width:100%;position:fixed;height:100%;left:0;top:0;background:rgba(255,255,255,0);z-index:9999;"></div>
    <script type="text/x-handlebars-template" id="tpl-image">
        <div style="text-align:center; padding-top:10px;">
            <img src="<%= src %>" height="490">
        </div>
    </script>
    <script type="text/x-handlebars-template" id="tpl-movie">
        <iframe src="<%= url %>" frameborder="0" marginwidth="0" marginheight="0" width="100%" height="100%" scrolling="yes"></iframe>
    </script>
    <script type="text/x-handlebars-template" id="tpl-diamond-list">
        <% _.each(data.datas,function(n){ %>
            <tr class="diamond-list-tr" data-diamond-id="<%= n.dia_id %>">
                <td class="product-goodsno" style="display: none">
                    <%= n.goodsno %>
                </td>
                <!-- <td class="product-more-button" style="font-size:10px;display:none" data-certno="<%= n[13] %>"><span class="product-style"><%= n[1] %></span><i class="icon-detail"></i></td> -->
                <td class="product-weight" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.weight %>
                </td>
                <td class="product-color" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.color %>
                </td>
                <td class="product-clarity" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.clarity %>
                </td>
                <td class="product-cut" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.cut %>
                </td>
                <td class="product-polish" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.polish %>
                </td>
                <td class="product-symmetry" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.symmetry %>
                </td>
                <td class="product-fluorescence" style="padding:1em 0 0.2em; text-align:center;font-size:14px;">
                    <%= n.light %>
                </td>
                <td class="product-dia" style="padding:1em 0 0.2em; text-align:center;font-size:14px;" colspan="2">
                    <%= n.diameter %>
                </td>
                <td style="padding: 2px 2px 2px 2px; text-align:center;font-size:14px;" rowspan="2"><a class="icon-buying ub-pc ub-ac bc-bg-a1" style="color:#fff; padding: 1.4em 1em; border-radius: 4px;">选定</a></td>
                <td style="display:none">

                </td>
                <td style="display:none">

                </td>
                <td class="product-cert" style="display:none">

                </td>
                <!-- <td class="product-cert-no"  style="display:none"><%= n[13] %></td> -->
                <td style="display:none">

                </td>
                <td style="display:none">

                </td>
                <!-- <a class="report-link" href="<%= n.dia_report_link %>" target="_blank"  style="display:none"></a>-->
                <!-- 如果是万宝二级的零售模式下的会员,则不展示国际美金-->
                <td style="display:none">

                </td>

                <td style="display:none">

                </td>
                <!-- <td  class="product-money" style="font-size:10px;display:none;"><%= (n[18] - 0).toFixed(2) %></td> -->
                <td style="display:none">

                </td>
                <td style="padding:4px;font-size:12px;display:none;">
                    <a class="icon-buying ub ub-f1 ub-pc ub-ac bc-bg-a1" style="color:#fff;height:32px;display:none; "> 选定 </a></td>
            </tr>
            <!--<tr class="diamond-list-tr">
                <td colspan="3">直径：
                    <%= n[9] %>
                </td>
                <td colspan="4">奶咖：
                    <%= n[10] %>
                        <%= n[11] %>
                </td>
            </tr>-->
            <!-- 第二行数据 -->
            <tr class="diamond-list-tr" style="border-bottom: 0.5px #f1f1f1 solid">
                <!--<td colspan="2" class="choose-flag" style="padding:0.4em 1em; font-size:10px; text-align:left;display:none;">
                    <%= n[0] %>
                </td>-->
                <td class="product-more-button" style="padding:0.4em 0 1em;font-size:14px;position:relative;text-decoration:underline;" data-certno="<%= n[13] %>">
                    <%= n.shape %>
                </td>
                <td style="padding:0.4em 0 1em;font-size:14px;">GIA</td>
                <td colspan="3" class="product-cert-no" style="padding:0.4em 0 1em;font-size:12px;text-decoration:underline;"><span><img src="./images/icons/detail.png" alt=""></span>
                    <%= n.certno %>
                </td>
                <td colspan="2" style="padding:0.4em 0 1em; font-size:12px;">
                    <% if(n.coffee === '1') { %>
                        带咖
                        <% } else { %>
                            不咖
                            <% } %>
                                <% if(n.milk === '1') { %>
                                    带奶
                                    <% } else { %>
                                        不奶
                                        <% } %>
                </td>
                <!-- <td colspan="2" style="font-size:14px;text-align:left;"><%= n[0] %></td> -->
                <td class="product-money" style="width:84px; padding: 0.4em 0 1em; text-align:center; font-size:14px;">￥<span class="product-money-price" style="font-size:17px;"><%= n.certificate %></span></td>
            </tr>
            <% })%>
    </script>
    <script type="text/x-handlebars-template" id="tpl-reporter">
        <iframe src="<%= url %>" frameborder="0" marginwidth="0" marginheight="0" width="100%" height="100%" scrolling="yes"></iframe>
    </script>
    <script src="GIA_files/underscore-min.js"></script>
    <script src="GIA_files/documentExternalClick.js"></script>
    <script src="GIA_files/Basic.js"></script>
    <script src="GIA_files/Checkbox.js"></script>
    <script src="GIA_files/Popwin.js"></script>
    <script src="GIA_files/Pagination.js"></script>
    <script src="GIA_files/main.js"></script>
    <script>
        var storage = window.localStorage;
        var key = storage["use_key"];
        var buyState = [];

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }

        function myStyle() {
            var myNum = 2;
            for (var k = 0; k < $('.diamond-list-tr').length; k++) {
                if (k % 2 == 0) {
                    $('.diamond-list-tr').eq(myNum * k).find("td").css({
                        "background": "#ffffff"
                    });
                    $('.diamond-list-tr').eq(myNum * k + 1).find("td").css({
                        "background": "#ffffff"
                    });
                    // $('.diamond-list-tr').eq(myNum * k + 2).find("td").css({
                    //     "background": "#ffffff"
                    // });
                } else {
                    $('.diamond-list-tr').eq(myNum * k).find("td").css({
                        "background": "rgb(233, 233, 233)"
                    });
                    $('.diamond-list-tr').eq(myNum * k + 1).find("td").css({
                        "background": "rgb(233, 233, 233)"
                    });
                    // $('.diamond-list-tr').eq(myNum * k + 2).find("td").css({
                    //     "background": "rgb(233, 233, 233)"
                    // });
                }
            }
        }
        //不咖不耐状态撤换
        function checkmilk(obj) {
            if (obj.is('.active')) {
                obj.removeClass('active');
            } else {
                $('.milkandcoffee').removeClass('active');
                obj.addClass('active');
            }

        }

        function success_masking() {

            $('#success-masking').css({
                "display": "block"
            });

        }

        $(document).ready(function () {
            $('#masking-control').on("click", function () {
                $('#success-masking').css({
                    "display": "none"
                });
            });
            $('#masking-opencart').on("click", function () {
                $('#success-masking').css({
                    "display": "none"
                });
                openWindow(4, '购物车列表',
                    appUrl + '/addons/ewei_shop/template/app/default/shop/cart.html?js=' +
                    Math.random());
            })
            if (getUrlParam('shape')) {
                $(".shape .option").each(function () {
                    if ($(this).data("value") == "1") {
                        $(this).addClass("active");
                    }
                });
            }
        })
        storage["strdiamond"] = '';
        var $doc = $(document);
        var user_type = 1;
        var is_bus_pifa = true;
        var $form = $("#diamond-search-form");
        $form.on("click", ".basic .option", function () {
            var $option = $(this);
            if ($option.is(".special")) {
                if ($(this).is(".active")) {
                    $form.find(".ex3 .option:not(.special)").removeClass("active");
                    $form.find(".cut .option:eq(0)").removeClass("active");
                    $form.find(".polish .option:eq(0)").removeClass("active");
                    $form.find(".symmetry .option:eq(0)").removeClass("active");
                    $form.find(".fluorescence .option:eq(0)").removeClass("active");
                    $(this).removeClass("active");
                } else {
                    $form.find(".ex3 .option:not(.special)").removeClass("active");
                    $form.find(".cut .option:eq(0)").addClass("active");
                    $form.find(".polish .option:eq(0)").addClass("active");
                    $form.find(".symmetry .option:eq(0)").addClass("active");
                    $form.find(".fluorescence .option:eq(0)").addClass("active");
                    $(this).addClass("active");
                }
            } else if ($option.is(".milkandcoffee")) {
                checkmilk($option);
            } else {
                $option.toggleClass("active");
                if ($form.find(".cut .option:eq(0)").is(".active") && $form.find(".polish .option:eq(0)").is(
                        ".active") && $form.find(".symmetry .option:eq(0)").is(".active") && $form.find(
                        ".fluorescence .option:eq(0)").is(".active")) {
                    $(".special").addClass("active");

                } else {
                    $(".special").removeClass("active");

                }

            }
        });

        //重量快捷选择层交互
        var $carat = $("#carat");
        var $caratOptionAssist = $carat.find(".option-assist");
        var $min = $carat.find(":text[data-role='min']");
        var $max = $carat.find(":text[data-role='max']");
        var showCaratOptionAssist = function () {
            $caratOptionAssist.show();
        };

        var hideCaratOptionAssist = function () {
            $caratOptionAssist.hide();
        };

        $carat.on("focus input", ":text", function (e) {
            e.preventDefault()
            showCaratOptionAssist();
            var min = $min.val() - 0;
            var max = $max.val() - 0;
            $caratOptionAssist.children().removeClass("active").filter(function () {
                var $this = $(this);
                return $this.data("min") - 0 == min && $this.data("max") - 0 == max;
            }).addClass("active");
        });

        $carat.on("click", ".option-assist > li", function (e) {
            e.preventDefault()
            var $this = $(this);
            $this.addClass("active").siblings().removeClass("active");
            $min.val($this.data("min"));
            $max.val($this.data("max"));
            hideCaratOptionAssist();
        });

        $.documentExternalClick.add(function (e) {
            if (!$(e.target).closest($carat)[0]) {
                hideCaratOptionAssist();
            }
        });

        //美化checkbox
        var syncCallback = function ($checkbox) {
            var $label = this.getLabel();
            if (this.isChecked()) {
                $label.addClass("active");
            } else {
                $label.removeClass("active");
            }
        };
        var checkboxSettings = {
            onchange: syncCallback,
            oninit: syncCallback
        };
        Checkbox.init("q_no_milky_shade", checkboxSettings); //不咖不奶
        Checkbox.init("q_shade_milky_shade", checkboxSettings); //浅咖不奶
        Checkbox.init("q_is_image", checkboxSettings); //有图
        Checkbox.init("q_is_movie", checkboxSettings); //有视频
        Checkbox.init("q_is_outside", checkboxSettings); //地区
        Checkbox.init("q_is_inside", checkboxSettings); //地区

        //ajax刷新数据列表
        var handleSearchData = function (data) {
            $diamondList.html(diamondListTpl({
                data: data
            }));

            $("#total_diamonds").text(data.total_diamonds);
            $("#total").text(data.total);

            init_click();
            myStyle();
            //chooseState();

            touch.on('.product-more-button', 'touchstart', function (ev) {
                var $newobj = $(this).siblings('.choose-flag').find('.extra-info').html();
                var $milkwindow = $(
                    "<div class='milkwindow' style='display:none;width:360%;position:absolute;left:-130%;top:80%;background:#fff;z-index:999;box-shadow:0 0 5px #888888;'></div>"
                );
                $milkwindow.html($newobj).appendTo($(this));
                $(this).find(".milkwindow").css({
                    "display": "block"
                });
                $("#window-top").css({
                    "display": "block"
                });
            })
        };

        // 搜索
        var searchRequest = function (params, isSearch, notGo2ListScreen) {

            var url = appUrl+'/app/index.php?i=2&c=entry&m=ewei_shop&v=pad&do=goods' +
                '&p=gia_spot&psize=999999&reqeustCode=10004&key=9f551e9b4fee3b0f5676c299158633f8';
            //console.log('请求数据了');
            console.log(params);


            if (params && params.page) {
                console.log(params.page);
                url = url + '&page=' + params.page;
            }
            if (params && params.weight) {
                console.log(params.weight);
                url = url + '&weight=' + params.weight;
            }
            console.log(url);
            // showLoadingIndicator(); //测试搜索数据列表临时注释           
            $.ajax({
                url: url,
                type: "get",
                dataType: 'jsonp',
                timeout: 30000,
                success: function (data) {
                    // 刷新数据列表
                    handleSearchData(data);

                    if (!notGo2ListScreen) {
                        window.location.hash = '';
                        window.location.hash = "#data-box-22";
                    }

                    if (isSearch) {
                        if (data.maxPage !== undefined) {
                            topPagination.refresh(data.maxPage);
                            bottomPagination.refresh(data.maxPage);
                            clearSortStyle();
                        }
                    } else {
                        topPagination.updatePaging();
                        bottomPagination.updatePaging();
                    }

                    if (user_type == 3) {
                        $.getJSON('http://' + 'www.zsagia.com' + '/consumer/cart_new/', function (data) {
                            parent.renderCart(data);
                        });
                    }

                    // 测试临时注释，生产环境需要打开
                    // hideLoadingIndicator();
                },
                error: function (data2) {
                    hideLoadingIndicator();
                    showToast("获取GIA数据失败，请重试");
                }
            })
        };

        searchRequest('', true, true);



        var pageChange = function () {
            //var params = {};
            queryString.page = this.current;
            searchRequest(queryString, false);
        };
        var createPagination = function (id) {
            return new Pagination({
                $container: $("#" + id),
                ajax: true,
                current: 1,
                pages: defPages,
                onRefresh: function () {
                    this.updatePaging();
                    // myStyle();
                },
                onchange: function () {
                    pageChange.call(this);
                    if (topPagination == this) {
                        queryString.page = this.current;
                        bottomPagination.current = this.current;
                        bottomPagination.updatePaging();
                    } else {
                        topPagination.current = this.current;
                        topPagination.updatePaging();
                        // myStyle();
                    }
                },
                updatePaging: function () {
                    this.$el.find(".paging").text(this.current + " / " + this.pages);
                },
                onShow: function () {
                    this.updatePaging();
                }
            })
        };

        //分页组件
        var queryString = {}; //数据请求参数
        var defPages = 1;
        var topPagination = createPagination("pagination-top");
        var bottomPagination = createPagination("pagination-bottom");

        topPagination.show();
        bottomPagination.show();

        //搜索
        var diamondListTpl = _.getTemplateById("tpl-diamond-list");
        var $diamondList = $("#diamond-list");

        touch.on('#btn_search', 'touchstart', function (ev) {
            $("#btn_search").removeClass("bc-bg-a1");
            $("#btn_search").addClass("bc-bg-a2");
        });

        touch.on('#btn_search', 'touchend', function (ev) {
            $("#btn_search").removeClass("bc-bg-a2");
            $("#btn_search").addClass("bc-bg-a1");
        });

        touch.on('#btn_reset', 'touchstart', function (ev) {
            $("#btn_reset").removeClass("bc-bg-a1");
            $("#btn_reset").addClass("bc-bg-a2");
        });

        touch.on('#btn_reset', 'touchend', function (ev) {
            $("#btn_reset").removeClass("bc-bg-a2");
            $("#btn_reset").addClass("bc-bg-a1");

        });

        // 点击搜索
        $("#btn_search").click(function (e) {
            //showLoadingIndicator();

            e.preventDefault();

            //全部参数数组
            var params = {};

            //获取参数和值函数
            var getOptionValue = function ($obj) {
                var param_value = [];

                $.each($obj, function () {
                    param_value.push($(this).data('value'));
                });

                //param_value = eval(param_value.join('+'));
                //param_value = param_value ? param_value : 0;
                //console.log(param_value);
                return param_value;
            };

            //颜色参数
            var $color = $(".color .option.active");
            params.param_color = getOptionValue($color);
            //console.log(params.param_color);
            // params.push(param_color);
            //console.log("颜色"+params.param_color);

            //净度参数
            var $clarity = $(".clarity .option.active");
            params.param_clarity = getOptionValue($clarity);
            //params.push(param_clarity);
            //console.log("净度" + params.param_clarity);

            //切工参数
            var $cut = $(".cut .option.active");
            params.param_cut = getOptionValue($cut);
            //console.log("切工"+ params.param_cut);


            //荧光参数
            var $fluorescence = $(".fluorescence .option.active");
            params.param_fluorescence = getOptionValue($fluorescence);
            //console.log("荧光" + params.param_fluorescence);

            //console.log(params);

            //证书参数
            var q_id = $("#q_id1").val(); // 证书号
            var q_type = $('#q_id1').parent().prev().children('div')
                .children('input[name="certificate"]:checked').val(); // 证书类型
            q_id = $.trim(q_id)
            //console.log(q_type);
            //console.log(q_id);
            queryString = params;
            if (q_id) {
                var searchByCertnoParams = {};
                searchByCertnoParams.certno = q_id;
                searchByCertnoParams.type = q_type;
                searchRequest(searchByCertnoParams, true);
            } else {
                searchRequest(queryString, true);
            }

        });

        //重置
        $("#btn_reset").click(function (e) {
            e.preventDefault();
            location.reload();
        });

        if (user_type == 3) {
            parent.queryCart();
        }

        //证书弹出窗
        var $dataTable = $("#diamond-data-table");

        var reporterWin = {};
        $dataTable.on("click", ".report-link", function (e) {
            e.preventDefault();
            var $link = $(this);
            var diamond_id = $link.closest("tr").data("diamond-id");
            var url = $(this).attr("href");
            url = 'http://' + 'www.zsagia.com' + url;
            var popwin = reporterWin[diamond_id];

            if (!popwin) {
                popwin = reporterWin[diamond_id] = new Popwin({
                    data: {
                        title: "钻石证书",
                        html: _.renderTemplate("tpl-reporter", {
                            url: url
                        })
                    },
                    onShow: function () {}
                });
                popwin.theme("reporter-win");
            }
            popwin.show();
        });

        //图片弹出窗
        var imageWin = {};
        $dataTable.on("click", ".icon-img", function (e) {
            e.preventDefault();
            var $tr = $(this).closest("tr");
            var diamondId = $tr.data("diamond-id");
            var src = $(this).attr("href");

            if (!imageWin[diamondId]) {
                imageWin[diamondId] = new Popwin({
                    data: {
                        title: "查看图片",
                        html: _.renderTemplate("tpl-image", {
                            src: src
                        })
                    }
                });
                //imageWin[diamondId].theme("diamond-image-win");
                imageWin[diamondId].theme("image-win");
            }
            imageWin[diamondId].show();
        });

        //修改排序方式
        var clearSortStyle = function () {
            $dataTable.find(".sortable").removeClass("asc desc");
        };

        var orderBy = function (by) {
            // var _by = _.getQueryString("q_orderby", queryString);
            var weight = queryString.weight;
            var $link = $("#order-by-" + by + "-link");
            clearSortStyle();

            if (weight == "asc") {
                queryString.weight = 'desc'
                $link.addClass("desc");
                console.log('dasc');
            } else {
                queryString.weight = 'asc';
                $link.addClass("asc");
                console.log('11111asc');
            }
            console.log(queryString.weight);
            searchRequest(queryString, false);
        };
        
        //排序
        var sortParam = ["carat", "price", "discount"];

        _.each(sortParam, function (n, i) {
            $doc.on("click", "#order-by-" + n + "-link", function () {
                orderBy(n);
            });
        });

        function init_click() {
            touch.on('#window-top', 'touchstart', function () {
                $('.milkwindow').css({
                    "display": "none"
                }).remove();
                $(this).css({
                    "display": "none"
                });
            })

            // 下载证书
            $('.product-cert-no').click(function () {
                var cert_num = $(this).text();
                console.log(cert_num);
                var url = appUrl + '/addons/ewei_shop/api/pdf.php?gia=' + cert_num + '&key=' + key;
                console.log(url);
                downloadGIACer(cert_num, url);
            });

            touch.on('.icon-buying', 'touchstart', function (ev) {
                $(this).removeClass("bc-bg-a1");
                $(this).addClass("bc-bg-a2");
            });
            touch.on('.icon-buying', 'touchend', function (ev) {
                $(this).removeClass("bc-bg-a2");
                $(this).addClass("bc-bg-a1");
                $that = $(this);
                var urlparam = getUrlParam('shape');
                var id = getUrlParam('id');
                var $obj = $(this);
                console.log(this);
                // 第一行
                var objtrPrev = $obj.closest("tr");
                var objtr = objtrPrev.next("tr");
                var productno = objtrPrev.find('.product-goodsno').html(); //货号
                //var strdiamond='{"code":200,"resultCode":0,"datas":{"sn":"12991963","style":"垫形","weight":"2.01","color":"G","clarity":"SI2","cut":"--","polish":"VG","symmetry":"GD","fluorescence":"N","certtype":"IGI","certno":"201627837","price":"38402.00"}}';
                var strdiamond2 = '{"sn":"' + productno + '","style":"' + objtr.find('.product-more-button').html() +
                    '","weight":"' + objtrPrev.find('.product-weight').html() + '","color":"' + objtrPrev.find(
                        '.product-color').html() + '","clarity":"' + objtrPrev.find('.product-clarity').html() +
                    '","cut":"' + objtrPrev.find('.product-cut').html() + '","polish":"' + objtrPrev.find(
                        '.product-polish').html() + '","symmetry":"' + objtrPrev.find('.product-symmetry').html() +
                    '","fluorescence":"' + objtrPrev.find('.product-fluorescence').html() +
                    '","certtype":"GIA","certno":"' + objtr.find('.product-cert-no').text() + '","price":"' +
                    objtr.find('.product-money-price').html() + '"}';

                var strdiamond = JSON.parse(strdiamond2);
                var giaprice = objtr.find('.product-money-price').html();
                console.log(strdiamond2);
                console.log(giaprice);
                //$.alert('123');
                if ($that.html() != "已选") {
                    $.ajax({
                        url: appUrl +
                            '/app/index.php?i=2&c=entry&m=ewei_shop&v=pad&do=member&p=member_cart&act=add&key=' +
                            key,
                        type: "post",
                        data: {
                            gia: strdiamond,
                            price: giaprice
                        },
                        dataType: 'jsonp',
                        success: function (data) {
                            //alert(JSON.stringify(data));
                            // openWindow(4, '购物车列表', appUrl + '/addons/ewei_shop/template/app/default/shop/cart.html?js='+ Math.random());
                            // refresh();//选择后刷新
                            showToast("添加购物车成功!"); //暂时屏蔽测试
                            $that.css({
                                "background": "#dddddd"
                            }).html("已选");
                            buyState.push(productno);
                            // success_masking();
                            onAddShoppingCartSucceed()
                        },
                        error: function (data2) {
                            //showToast("error!");                      
                            showToast("添加购物车失败!请检查网络"); //暂时屏蔽测试
                        }
                    })
                }
            });
        }

        function nextstep(strdiamond) {
            storage["strdiamond"] = strdiamond;
            openWindow(6, '产品列表', appUrl + '/addons/ewei_shop/template/app/default/shop/list.html');
        }
        //http://www.zsmtvip.com/app/index.php?i=2&c=entry&do=addcart&m=test&key=fe37b7b37c60384e6b13d8e9d732c7e5
        touch.on('.btmore', 'tap', function (ev) {
            var flag = $(this).data("flag");
            if (flag == 0) {
                $('.extradiv').removeClass("uhide");
                $('.btmore').html('收起高级搜索');
                $(this).data("flag", "1");
                // ev.stopPropagation();
            } else {
                $('.extradiv').addClass("uhide");
                $('.btmore').html('显示高级搜索');
                $(this).data("flag", "0");
                // ev.stopPropagation();
            }
        })
    </script>
    <script>
        // 重量匹配选择
        $(function () {
            $('#weight01').change(function () {
                var $weighor = parseInt($('#weight01').val() * 100);
                var $weighor2 = parseInt($('#weight02').val() * 100);
                console.log($weighor);
                if ($weighor < 40) {
                    $('#rangeselect').val('1');
                    $('#weight02').val('0.39');
                } else if ($weighor < 50) {
                    $('#rangeselect').val('2');
                    $('#weight02').val('0.49');
                } else if ($weighor < 60) {
                    $('#rangeselect').val('3');
                    $('#weight02').val('0.59');
                } else if ($weighor < 70) {
                    $('#rangeselect').val('4');
                    $('#weight02').val('0.69');
                } else if ($weighor < 80) {
                    $('#rangeselect').val('5');
                    $('#weight02').val('0.79');
                } else if ($weighor < 90) {
                    $('#rangeselect').val('6');
                    $('#weight02').val('0.89');
                } else if ($weighor < 100) {
                    $('#rangeselect').val('7');
                    $('#weight02').val('0.99');
                } else if ($weighor < 110) {
                    $('#rangeselect').val('8');
                    $('#weight02').val('1.09');
                } else if ($weighor < 150) {
                    $('#rangeselect').val('9');
                    $('#weight02').val('1.49');
                } else if ($weighor < 200) {
                    $('#rangeselect').val('10');
                    $('#weight02').val('1.99');
                } else if ($weighor < 300) {
                    $('#rangeselect').val('12');
                    $('#weight02').val('2.99');
                } else if ($weighor < 9900) {
                    $('#rangeselect').val('13');
                    $('#weight02').val('99');
                } else {
                    $('#rangeselect').val('11');
                }
            });

            $('#weight02').change(function () {
                var $weighor = parseInt($('#weight01').val() * 100);
                var $weighor2 = parseInt($('#weight02').val() * 100);
                console.log($weighor2);
                //console.log($weighor2);
                if ($weighor > $weighor2) {
                    if ($weighor < 40) {
                        $('#rangeselect').val('1');
                        $('#weight02').val('0.39');
                    } else if ($weighor < 50) {
                        $('#rangeselect').val('2');
                        $('#weight02').val('0.49');
                    } else if ($weighor < 60) {
                        $('#rangeselect').val('3');
                        $('#weight02').val('0.59');
                    } else if ($weighor < 70) {
                        $('#rangeselect').val('4');
                        $('#weight02').val('0.69');
                    } else if ($weighor < 80) {
                        $('#rangeselect').val('5');
                        $('#weight02').val('0.79');
                    } else if ($weighor < 90) {
                        $('#rangeselect').val('6');
                        $('#weight02').val('0.89');
                    } else if ($weighor < 100) {
                        $('#rangeselect').val('7');
                        $('#weight02').val('0.99');
                    } else if ($weighor < 110) {
                        $('#rangeselect').val('8');
                        $('#weight02').val('1.09');
                    } else if ($weighor < 150) {
                        $('#rangeselect').val('9');
                        $('#weight02').val('1.49');
                    } else if ($weighor < 200) {
                        $('#rangeselect').val('10');
                        $('#weight02').val('1.99');
                    } else if ($weighor < 300) {
                        $('#rangeselect').val('12');
                        $('#weight02').val('2.99');
                    } else if ($weighor < 9900) {
                        $('#rangeselect').val('13');
                        $('#weight02').val('99');
                    } else {
                        $('#rangeselect').val('11');
                    }
                }
            });
            // 自动范围选择
            $('#rangeselect').change(function () {
                var $selected = $('#rangeselect').val();
                if ($selected == 11) {
                    $('#weight01').val('');
                    $('#weight02').val('');
                } else if ($selected == 1) {
                    $('#weight01').val('0.3');
                    $('#weight02').val('0.39');
                } else if ($selected == 2) {
                    $('#weight01').val('0.4');
                    $('#weight02').val('0.49');
                } else if ($selected == 3) {
                    $('#weight01').val('0.5');
                    $('#weight02').val('0.59');
                } else if ($selected == 4) {
                    $('#weight01').val('0.6');
                    $('#weight02').val('0.69');
                } else if ($selected == 5) {
                    $('#weight01').val('0.7');
                    $('#weight02').val('0.79');
                } else if ($selected == 6) {
                    $('#weight01').val('0.8');
                    $('#weight02').val('0.89');
                } else if ($selected == 7) {
                    $('#weight01').val('0.9');
                    $('#weight02').val('0.99');
                } else if ($selected == 8) {
                    $('#weight01').val('1.0');
                    $('#weight02').val('1.09');
                } else if ($selected == 9) {
                    $('#weight01').val('1.1');
                    $('#weight02').val('1.49');
                } else if ($selected == 10) {
                    $('#weight01').val('1.5');
                    $('#weight02').val('1.99');
                } else if ($selected == 12) {
                    $('#weight01').val('2.0');
                    $('#weight02').val('2.99');
                } else if ($selected == 13) {
                    $('#weight01').val('3.0');
                    $('#weight02').val('99');
                } else {
                    $('#weight01').val('');
                    $('#weight02').val('');
                }
            });
        })
    </script>
</body>

</html>